package code.blurone.snifferexploited

import org.bukkit.NamespacedKey
import org.bukkit.configuration.ConfigurationSection
import org.bukkit.entity.EntityType
import org.bukkit.entity.Player
import org.bukkit.event.EventHandler
import org.bukkit.event.Listener
import org.bukkit.event.entity.EntityPickupItemEvent
import org.bukkit.inventory.meta.SkullMeta

class OcdTranslator(private val itemTranslations: ConfigurationSection, private val infoTranslations: ConfigurationSection, private val potionNamespacedKey: NamespacedKey) : Listener {
    @EventHandler
    fun ocdTranslator(event: EntityPickupItemEvent)
    {
        if (event.entity.type != EntityType.PLAYER ||
            !isSniffingPotion(event.item.itemStack, potionNamespacedKey))
            return

        val locale = (event.entity as Player).locale
        val strippedLocale = locale.split("_")[0]
        val meta = event.item.itemStack.itemMeta!!
        itemTranslations.getString(
            locale,
            itemTranslations.getString(strippedLocale, defaultPotionName)
        )!!.let { meta.setDisplayName("ยงr$it") }
        infoTranslations.getString(
            locale,
            infoTranslations.getString(strippedLocale, defaultPotionInfo)
        )!!.let { meta.lore = listOf("ยง9$it") }
        event.item.itemStack.itemMeta = meta
    }
}